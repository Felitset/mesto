(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var t=function(){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.validationConfig=e,this.formType=n,this.inputList=Array.from(this.formType.querySelectorAll(this.validationConfig.formInput)),this.formButton=this.formType.querySelector(this.validationConfig.formButton)}var n,o;return n=t,(o=[{key:"_showInputError",value:function(e,t){var n=this.formType.querySelector(".".concat(e.id,"-error"));e.classList.add(this.validationConfig.inputErrorClass),n.textContent=t,n.classList.add(this.validationConfig.errorElement)}},{key:"_hideInputError",value:function(e){var t=this.formType.querySelector(".".concat(e.id,"-error"));e.classList.remove(this.validationConfig.inputErrorClass),t.classList.remove(this.validationConfig.errorElement),t.textContent=""}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}},{key:"_setEventListeners",value:function(){var e=this;this._toggleButtonState(),this.inputList.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e._toggleButtonState()}))}))}},{key:"enableValidation",value:function(){this.formType.addEventListener("submit",(function(e){e.preventDefault()})),this._setEventListeners(this.formType)}},{key:"_activatePopupButton",value:function(){this.formButton.classList.add(this.validationConfig.activeButtonClass),this.formButton.removeAttribute("disabled")}},{key:"deactivateSubmitButton",value:function(){this.formButton.classList.remove(this.validationConfig.activeButtonClass),this.formButton.setAttribute("disabled",!0)}},{key:"_hasInvalidInput",value:function(){return this.inputList.some((function(e){return!e.validity.valid}))}},{key:"_toggleButtonState",value:function(){this._hasInvalidInput()?this.deactivateSubmitButton():this._activatePopupButton()}},{key:"clearInputErrors",value:function(){var e=this,t=[];this.inputList.forEach((function(n){n.classList.remove(e.validationConfig.inputErrorClass),t.push(document.querySelector(".".concat(n.id,"-error")))})),t.forEach((function(e){e.textContent=""}))}}])&&e(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),t}(),n="https://nomoreparties.co/v1/cohort-50",o="029a79a7-8fba-4611-80b7-2d8ae6512fbe",r=n+"/cards",i=n+"/users/me",u="d84cc643d77f83ecc2760814";function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var c=function(){function e(t,n,o,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._title=t.card_title,this._image=t.image_link,this.cardId=t.card_id,this._ownerId=t.owner_id,this._likesNumber=t.likes_number,this._userLikeFlag=t.user_like_flag,this._apiCaller=n,this._handleCardClick=o,this._handleDeleteClick=r}var t,n;return t=e,(n=[{key:"_getTemplate",value:function(){return document.querySelector(".gallery-template").content.querySelector(".gallery__item").cloneNode(!0)}},{key:"_setLikesOnCard",value:function(){this._element.querySelector(".gallery__like-counter").textContent=this._likesNumber}},{key:"generateCard",value:function(){return this._element=this._getTemplate(),this.image=this._element.querySelector(".gallery__image"),this._element.querySelector(".gallery__title").textContent=this._title,this.image.src=this._image,this.image.alt=this._title,this._setLikesOnCard(),this._setEventListeners(),this._manageDeleteButton(),1==this._userLikeFlag&&this._changeHeart(),this._element}},{key:"_changeHeart",value:function(){this._cardLikeButton.classList.toggle("gallery__like_status_active")}},{key:"_changeLikeStatus",value:function(){this._changeHeart(),this._cardLikeButton.classList.contains("gallery__like_status_active")?(this._apiCaller.saveRemoteLike(this.cardId),this._likesNumber=this._likesNumber+1):(this._apiCaller.deleteRemoteLike(this.cardId),this._likesNumber=this._likesNumber-1),this._setLikesOnCard()}},{key:"_manageDeleteButton",value:function(){this._ownerId!==u&&(this._deleteButtonElement.style.display="none")}},{key:"deleteCard",value:function(){this._element.remove()}},{key:"_setEventListeners",value:function(){var e=this;this._deleteButtonElement=this._element.querySelector(".gallery__delete-item"),this._cardLikeButton=this._element.querySelector(".gallery__like"),this._cardImageLink=this._element.querySelector(".gallery__image"),this._deleteButtonElement.addEventListener("click",(function(){e._handleDeleteClick()})),this._cardLikeButton.addEventListener("click",(function(){e._changeLikeStatus()})),this._cardImageLink.addEventListener("click",(function(){var t={name:e._title,link:e._image};e._handleCardClick(t)}))}}])&&a(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),l=".popup__form",s={formInput:".popup__input",formButton:".popup__button",activeButtonClass:"popup__button_active",inputErrorClass:"popup__input_type_error",errorElement:"popup__input-error_message"},p=document.querySelector(".profile__avatar"),f=document.querySelector(".popup-profile-edit"),h=f.querySelector(l),y=document.querySelector(".popup-add-card"),d=document.querySelector(".popup-card-image"),v=document.querySelector(".popup-new-avatar"),m=document.querySelector(".popup-delete-card"),_=document.querySelector(".profile__edit-button"),b=document.querySelector(".profile__add-button"),g=v.querySelector(".popup__form_new-avatar"),k=document.querySelector(".profile__wrapper"),S=y.querySelector(l),E=(v.querySelector(".popup__input_type_avatar-image-link"),document.querySelector(".profile__name")),w=document.querySelector(".profile__description"),O=document.querySelector(".gallery");function C(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var P=function(){function e(t,n){var o=t.items,r=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.items=o,this.renderer=r,this.containerSelector=n}var t,n;return t=e,(n=[{key:"createAllElements",value:function(){var e=this;this.items.forEach((function(t){e.addItem(e.renderer(t))}))}},{key:"addItem",value:function(e){this.containerSelector.prepend(e)}}])&&C(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function L(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var j=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.popupSelector=t,this.closeButtonElement=this.popupSelector.querySelector(".popup__close"),this._handleEscClose=this._handleEscClose.bind(this),this._handleOverlayClose=this._handleOverlayClose.bind(this),this.closePopup=this.closePopup.bind(this),this.button=this.popupSelector.querySelector(".popup__button")}var t,n;return t=e,(n=[{key:"openPopup",value:function(){this.popupSelector.classList.add("popup_is-opened"),document.addEventListener("keydown",this._handleEscClose),this.setEventListeners()}},{key:"closePopup",value:function(){this.popupSelector.classList.remove("popup_is-opened"),document.removeEventListener("keydown",this._handleEscClose),this.removeEventListeners()}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.closePopup()}},{key:"_handleOverlayClose",value:function(e){(e.target.querySelector(".popup__transparent-container")||e.target.querySelector(".popup__container"))&&this.closePopup()}},{key:"changeSubmitButtonText",value:function(e){this.button.textContent=e}},{key:"setEventListeners",value:function(){this.closeButtonElement.addEventListener("click",this.closePopup),this.popupSelector.addEventListener("click",this._handleOverlayClose)}},{key:"removeEventListeners",value:function(){this.closeButtonElement.removeEventListener("click",this.closePopup),this.popupSelector.removeEventListener("click",this._handleOverlayClose)}}])&&L(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function T(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function q(){return q="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var o=I(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},q.apply(this,arguments)}function I(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=D(e)););return e}function R(e,t){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},R(e,t)}function x(e,t){if(t&&("object"===B(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function D(e){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},D(e)}var A=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&R(e,t)}(u,e);var t,n,o,r,i=(o=u,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=D(o);if(r){var n=D(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return x(this,e)});function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,e)).popup=e.querySelector(".popup__image"),t.popupTitle=e.querySelector(".popup__image-title"),t}return t=u,(n=[{key:"openPopup",value:function(e){this._image=e.image,this._title=e.title,this.popup.src=this._image,this.popupTitle.textContent=this._title,this.popup.alt=this._title,q(D(u.prototype),"openPopup",this).call(this)}}])&&T(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(j);function N(e){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N(e)}function H(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function V(){return V="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var o=U(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},V.apply(this,arguments)}function U(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=G(e)););return e}function z(e,t){return z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},z(e,t)}function J(e,t){if(t&&("object"===N(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return F(e)}function F(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function G(e){return G=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},G(e)}var M=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&z(e,t)}(u,e);var t,n,o,r,i=(o=u,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=G(o);if(r){var n=G(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return J(this,e)});function u(e,t,n){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(o=i.call(this,e)).submitHandler=t,o.submiting=o.submiting.bind(F(o)),o.formValidator=n,o.inputName=o.popupSelector.querySelector(".popup__input_type_name"),o.inputJob=o.popupSelector.querySelector(".popup__input_type_job"),o.form=o.popupSelector.querySelector(".popup__form"),o.submitButton=o.popupSelector.querySelector(".popup__button"),o.closePopup=o.closePopup.bind(F(o)),o._inputList=o.popupSelector.querySelectorAll(".popup__input"),o.closePopup=o.closePopup.bind(F(o)),o}return t=u,(n=[{key:"_getInputValues",value:function(){var e={};return this._inputList.forEach((function(t){e[t.name]=t.value})),e}},{key:"setInputValues",value:function(e){this._inputList.forEach((function(t){t.value=e[t.name]}))}},{key:"submiting",value:function(e){var t=this._getInputValues();this.submitHandler(e,t)}},{key:"setEventListeners",value:function(){V(G(u.prototype),"setEventListeners",this).call(this),this.popupSelector.addEventListener("submit",this.submiting),this.popupSelector.addEventListener("submit",this.closePopup)}},{key:"removeEventListeners",value:function(){V(G(u.prototype),"removeEventListeners",this).call(this),this.popupSelector.removeEventListener("submit",this.submiting),this.popupSelector.removeEventListener("submit",this.closePopup)}},{key:"closePopup",value:function(){this.form.reset(),V(G(u.prototype),"closePopup",this).call(this)}}])&&H(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(j);function K(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Q=function(){function e(t){var n=t.name,o=t.profession;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=n,this.profession=o}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{name:this.name.textContent,profession:this.profession.textContent}}},{key:"setUserInfo",value:function(e){this.name.textContent=e.name,this.profession.textContent=e.profession}}])&&K(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function W(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var X=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,(n=[{key:"saveRemoteLike",value:function(e){fetch(r+"/"+e+"/likes",{method:"PUT",headers:{authorization:o}}).catch((function(e){console.log(e)}))}},{key:"deleteRemoteLike",value:function(e){fetch(r+"/"+e+"/likes",{method:"DELETE",headers:{authorization:o}}).catch((function(e){console.log(e)}))}},{key:"saveUser",value:function(e){return fetch(i,{method:"PATCH",headers:{authorization:o,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,about:e.profession})}).catch((function(e){console.log(e)}))}},{key:"getUser",value:function(){return fetch(i,{method:"GET",headers:{authorization:o}}).catch((function(e){console.log(e)}))}},{key:"saveCard",value:function(e){return fetch(r,{method:"POST",headers:{authorization:o,"Content-Type":"application/json"},body:JSON.stringify({name:e.card_title,link:e.image_link})}).catch((function(e){console.log(e)}))}},{key:"deleteCard",value:function(e){return fetch(r+"/"+e,{method:"DELETE",headers:{authorization:o,"Content-Type":"application/json"}}).catch((function(e){console.log(e)}))}},{key:"getAllCards",value:function(){return fetch(r,{method:"GET",headers:{authorization:o}}).catch((function(e){console.log(e)}))}},{key:"postNewAvatar",value:function(e){return fetch(i+"/avatar",{method:"PATCH",headers:{authorization:o,"Content-Type":"application/json"},body:JSON.stringify({avatar:e.avatar_link})}).catch((function(e){console.log(e)}))}}])&&W(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Y(e){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Y(e)}function Z(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function $(){return $="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var o=ee(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},$.apply(this,arguments)}function ee(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=oe(e)););return e}function te(e,t){return te=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},te(e,t)}function ne(e,t){if(t&&("object"===Y(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function oe(e){return oe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},oe(e)}var re=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&te(e,t)}(u,e);var t,n,o,r,i=(o=u,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=oe(o);if(r){var n=oe(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ne(this,e)});function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,e))._submitButton=t.popupSelector.querySelector(".popup__button-yes"),t}return t=u,(n=[{key:"setEventListeners",value:function(){$(oe(u.prototype),"setEventListeners",this).call(this),this._submitButton.addEventListener("click",this._submitHandler)}},{key:"removeEventListeners",value:function(){$(oe(u.prototype),"removeEventListeners",this).call(this),this._submitButton.removeEventListener("click",this._submitHandler)}},{key:"setSubmitHandler",value:function(e){this._submitHandler=e}}])&&Z(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(j),ie=new X,ue=new M(y,(function(e,t){e.preventDefault(),ue.changeSubmitButtonText("Сохранение..."),ie.saveCard(t).then((function(e){return e.json()})).then((function(e){var n=Object.assign({},t,{likes_number:0,card_id:e._id,users_like_flag:0,owner_id:u});fe.addItem(fe.renderer(n))})).then((function(){ue.changeSubmitButtonText("Сохранить")}))}),ye),ae=new M(f,(function(e,t){e.preventDefault(),he.setUserInfo(t),ae.changeSubmitButtonText("Сохранение..."),ie.saveUser(t).then((function(){ae.changeSubmitButtonText("Сохранить")}))}),de),ce=new M(v,(function(e,t){e.preventDefault(),p.src=t.avatar_link,ce.changeSubmitButtonText("Сохранение..."),ie.postNewAvatar(t).then((function(){ce.changeSubmitButtonText("Сохранить")}))}),ve),le=new A(d),se=new re(m);function pe(e){var t=new c(e,ie,(function(){le.openPopup({image:e.image_link,title:e.card_title})}),(function(){se.setSubmitHandler((function(){se.changeSubmitButtonText("Удаление..."),ie.deleteCard(e.card_id).then((function(){t.deleteCard(),se.closePopup()})).then((function(){se.changeSubmitButtonText("Да")}))})),se.openPopup()}));return t.generateCard()}_.addEventListener("click",(function(){ae.openPopup();var e=he.getUserInfo();ae.setInputValues(e),de.clearInputErrors(),de.deactivateSubmitButton()})),b.addEventListener("click",(function(){ue.openPopup(),ue.form.reset(),ye.clearInputErrors(),ye.deactivateSubmitButton()})),k.addEventListener("click",(function(){ce.openPopup(),ce.form.reset(),ve.clearInputErrors(),ve.deactivateSubmitButton()}));var fe,he=new Q({name:E,profession:w});ie.getAllCards().then((function(e){return e.json()})).then((function(e){var t=[];return e.forEach((function(e){var n=0;e.likes.forEach((function(e){e:if(e._id==u){n=1;break e}})),t.push({card_title:e.name,image_link:e.link,likes_number:e.likes.length,card_id:e._id,user_like_flag:n,owner_id:e.owner._id})})),fe=new P({items:t,renderer:pe},O)})).then((function(e){e.createAllElements()}));var ye=new t(s,S);ye.enableValidation();var de=new t(s,h);de.enableValidation();var ve=new t(s,g);ve.enableValidation();var me={};ie.getUser().then((function(e){return e.json()})).then((function(e){me={name:e.name,profession:e.about},he.setUserInfo(me)}))})();